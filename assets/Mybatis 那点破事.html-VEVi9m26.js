import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as e,o as i}from"./app-NomDibRt.js";const l={};function t(p,s){return i(),a("div",null,s[0]||(s[0]=[e(`<h1 id="mybatis-é‚£ç‚¹ç ´äº‹-orm-åŠ¨æ€sqlã€åŠ¨æ€ä»£ç†" tabindex="-1"><a class="header-anchor" href="#mybatis-é‚£ç‚¹ç ´äº‹-orm-åŠ¨æ€sqlã€åŠ¨æ€ä»£ç†"><span>Mybatis é‚£ç‚¹ç ´äº‹ï¼ ORMï¼ŒåŠ¨æ€SQLã€åŠ¨æ€ä»£ç†</span></a></h1><blockquote><p>ä½œè€…ï¼šè€é©¬<br><br>å…¬ä¼—å·ï¼šè€é©¬å•¸è¥¿é£<br><br> åšå®¢ï¼š<a href="https://houbb.github.io/" target="_blank" rel="noopener noreferrer">https://houbb.github.io/</a><br><br> äººç”Ÿç†å¿µï¼šçŸ¥è¡Œåˆä¸€</p></blockquote><h2 id="ä»€ä¹ˆæ˜¯-mybatis" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-mybatis"><span><strong>ä»€ä¹ˆæ˜¯ MyBatis?</strong></span></a></h2><p>ç­”æ¡ˆï¼š<br>Mybatis æ˜¯ä¸€ä¸ªåŠ ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ¡†æ¶ï¼Œå®ƒå†…éƒ¨å°è£…äº† JDBCï¼Œå¼€å‘æ—¶åªéœ€è¦å…³æ³¨ SQL è¯­å¥æœ¬èº«ï¼Œä¸éœ€è¦èŠ±è´¹ç²¾åŠ›å»å¤„ç†åŠ è½½é©±åŠ¨ã€åˆ›å»ºè¿æ¥ã€åˆ›å»ºstatement ç­‰ç¹æ‚çš„è¿‡ç¨‹ã€‚ç¨‹åºå‘˜ç›´æ¥ç¼–å†™åŸç”Ÿæ€ sqlï¼Œå¯ä»¥ä¸¥æ ¼æ§åˆ¶ sql æ‰§è¡Œæ€§èƒ½ï¼Œçµæ´»åº¦é«˜ã€‚<br>MyBatis å¯ä»¥ä½¿ç”¨ XML æˆ–æ³¨è§£æ¥é…ç½®å’Œæ˜ å°„åŸç”Ÿä¿¡æ¯ï¼Œå°† POJO æ˜ å°„æˆæ•°æ®åº“ä¸­çš„è®°å½•ï¼Œé¿å…äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç å’Œæ‰‹åŠ¨è®¾ç½®å‚æ•°ä»¥åŠè·å–ç»“æœé›†ã€‚<br>é€šè¿‡ xml æ–‡ä»¶æˆ–æ³¨è§£çš„æ–¹å¼å°†è¦æ‰§è¡Œçš„å„ç§ statement é…ç½®èµ·æ¥ï¼Œå¹¶é€šè¿‡ java å¯¹è±¡å’Œ statement ä¸­ sql çš„åŠ¨æ€å‚æ•°è¿›è¡Œæ˜ å°„ç”Ÿæˆæœ€ç»ˆæ‰§è¡Œçš„ sql è¯­å¥ï¼Œæœ€åç”± mybatis æ¡†æ¶æ‰§è¡Œ sql å¹¶å°†ç»“æœæ˜ å°„ä¸º java å¯¹è±¡å¹¶è¿”å›ã€‚ï¼ˆä»æ‰§è¡Œ sql åˆ°è¿” å› result çš„è¿‡ç¨‹ï¼‰ã€‚</p><h2 id="mybatis-ä¼˜ç‚¹" tabindex="-1"><a class="header-anchor" href="#mybatis-ä¼˜ç‚¹"><span><strong>MyBatis ä¼˜ç‚¹ï¼Ÿ</strong><br><br></span></a></h2><p>ç­”æ¡ˆ</p><ol><li>åŸºäº SQL è¯­å¥ç¼–ç¨‹ï¼Œç›¸å½“çµæ´»ï¼Œä¸ä¼šå¯¹åº”ç”¨ç¨‹åºæˆ–è€…æ•°æ®åº“çš„ç°æœ‰è®¾è®¡é€ æˆä»»ä½•å½±å“ï¼ŒSQL å†™åœ¨ XML é‡Œï¼Œè§£é™¤ sql ä¸ç¨‹åºä»£ç çš„è€¦åˆï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†ï¼›æä¾› XML æ ‡ç­¾ï¼Œæ”¯æŒç¼–å†™åŠ¨æ€ SQL è¯­å¥ï¼Œå¹¶å¯é‡ç”¨ã€‚</li><li>ä¸ JDBC ç›¸æ¯”ï¼Œå‡å°‘äº† 50%ä»¥ä¸Šçš„ä»£ç é‡ï¼Œæ¶ˆé™¤äº† JDBC å¤§é‡å†—ä½™çš„ä»£ç ï¼Œä¸éœ€è¦æ‰‹åŠ¨å¼€å…³è¿æ¥ï¼›</li><li>å¾ˆå¥½çš„ä¸å„ç§æ•°æ®åº“å…¼å®¹ï¼ˆå› ä¸º MyBatis ä½¿ç”¨ JDBC æ¥è¿æ¥æ•°æ®åº“ï¼Œæ‰€ä»¥åªè¦ JDBC æ”¯æŒçš„æ•°æ®åº“ MyBatis éƒ½æ”¯æŒï¼‰ã€‚</li><li>èƒ½å¤Ÿä¸ Spring å¾ˆå¥½çš„é›†æˆï¼›</li><li>æä¾›æ˜ å°„æ ‡ç­¾ï¼Œæ”¯æŒå¯¹è±¡ä¸æ•°æ®åº“çš„ ORM å­—æ®µå…³ç³»æ˜ å°„ï¼›æä¾›å¯¹è±¡å…³ç³»æ˜ å°„æ ‡ç­¾ï¼Œæ”¯æŒå¯¹è±¡å…³ç³»ç»„ä»¶ç»´æŠ¤ã€‚</li></ol><h2 id="mybatis-ç¼ºç‚¹" tabindex="-1"><a class="header-anchor" href="#mybatis-ç¼ºç‚¹"><span><strong>MyBatis ç¼ºç‚¹ï¼Ÿ</strong></span></a></h2><p>ç­”æ¡ˆï¼š</p><ol><li>SQLè¯­å¥çš„ç¼–å†™å·¥ä½œé‡è¾ƒå¤§ï¼Œå°¤å…¶å½“å­—æ®µå¤šã€å…³è”è¡¨å¤šæ—¶ï¼Œå¯¹å¼€å‘äººå‘˜ç¼–å†™SQLè¯­å¥çš„åŠŸåº•æœ‰ä¸€å®šè¦æ±‚ã€‚</li><li>SQLè¯­å¥ä¾èµ–äºæ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“ç§»æ¤æ€§å·®ï¼Œä¸èƒ½éšæ„æ›´æ¢æ•°æ®åº“</li></ol><h2 id="orm-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#orm-æ˜¯ä»€ä¹ˆ"><span><strong>ORM æ˜¯ä»€ä¹ˆ?</strong><br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>ORMï¼ˆObject Relational Mappingï¼‰ï¼Œå¯¹è±¡å…³ç³»æ˜ å°„ã€‚<br>æ˜¯ä¸€ç§ä¸ºäº†è§£å†³å…³ç³»å‹æ•°æ®åº“æ•°æ®ä¸ç®€å•Javaå¯¹è±¡ï¼ˆPOJOï¼‰çš„æ˜ å°„å…³ç³»çš„æŠ€æœ¯ã€‚ç®€å•æ¥è¯´ï¼ŒORMæ˜¯é€šè¿‡ä½¿ç”¨æè¿°å¯¹è±¡å’Œæ•°æ®åº“ä¹‹é—´æ˜ å°„çš„å…ƒæ•°æ®ï¼Œå°†ç¨‹åºä¸­çš„å¯¹è±¡è‡ªåŠ¨æŒä¹…åŒ–åˆ°å…³ç³»å‹æ•°æ®åº“ä¸­ã€‚</p><h2 id="ä¸ºä»€ä¹ˆè¯´-mybatis-æ˜¯åŠè‡ªåŠ¨-orm-æ˜ å°„å·¥å…·-å®ƒä¸å…¨è‡ªåŠ¨çš„åŒºåˆ«åœ¨å“ªé‡Œ" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¯´-mybatis-æ˜¯åŠè‡ªåŠ¨-orm-æ˜ å°„å·¥å…·-å®ƒä¸å…¨è‡ªåŠ¨çš„åŒºåˆ«åœ¨å“ªé‡Œ"><span><strong>ä¸ºä»€ä¹ˆè¯´ Mybatis æ˜¯åŠè‡ªåŠ¨ ORM æ˜ å°„å·¥å…·ï¼Ÿå®ƒä¸å…¨è‡ªåŠ¨çš„åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ</strong></span></a></h2><p>ç­”æ¡ˆï¼š</p><ul><li>Hibernateå±äºå…¨è‡ªåŠ¨ORMæ˜ å°„å·¥å…·ï¼Œä½¿ç”¨HibernateæŸ¥è¯¢å…³è”å¯¹è±¡æˆ–è€…å…³è”é›†åˆå¯¹è±¡æ—¶ï¼Œå¯ä»¥æ ¹æ®å¯¹è±¡å…³ç³»æ¨¡å‹ç›´æ¥è·å–ï¼Œæ‰€ä»¥å®ƒæ˜¯å…¨è‡ªåŠ¨çš„ã€‚</li><li>è€ŒMybatisåœ¨æŸ¥è¯¢å…³è”å¯¹è±¡æˆ–å…³è”é›†åˆå¯¹è±¡æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨ç¼–å†™SQLæ¥å®Œæˆï¼Œæ‰€ä»¥ï¼Œè¢«ç§°ä¹‹ä¸ºåŠè‡ªåŠ¨ORMæ˜ å°„å·¥å…·ã€‚</li></ul><h2 id="jdbc-ç¼–ç¨‹æœ‰å“ªäº›ä¸è¶³ä¹‹å¤„" tabindex="-1"><a class="header-anchor" href="#jdbc-ç¼–ç¨‹æœ‰å“ªäº›ä¸è¶³ä¹‹å¤„"><span><strong>JDBC ç¼–ç¨‹æœ‰å“ªäº›ä¸è¶³ä¹‹å¤„ï¼Ÿ</strong></span></a></h2><p>ç­”æ¡ˆï¼š</p><ul><li>1ã€æ•°æ®è¿æ¥åˆ›å»ºã€é‡Šæ”¾é¢‘ç¹é€ æˆç³»ç»Ÿèµ„æºæµªè´¹ä»è€Œå½±å“ç³»ç»Ÿæ€§èƒ½ <ul><li>è§£å†³ï¼šåœ¨mybatis-config.xmlä¸­é…ç½®æ•°æ®é“¾æ¥æ± ï¼Œä½¿ç”¨è¿æ¥æ± ç»Ÿä¸€ç®¡ç†æ•°æ®åº“è¿æ¥ã€‚</li></ul></li><li>2ã€sqlè¯­å¥å†™åœ¨ä»£ç ä¸­é€ æˆä»£ç ä¸æ˜“ç»´æŠ¤ <ul><li>è§£å†³ï¼šå°†sqlè¯­å¥é…ç½®åœ¨XXXXmapper.xmlæ–‡ä»¶ä¸­ä¸javaä»£ç åˆ†ç¦»ã€‚</li></ul></li><li>3ã€å‘sqlè¯­å¥ä¼ å‚æ•°éº»çƒ¦ï¼Œå› ä¸ºsqlè¯­å¥çš„whereæ¡ä»¶ä¸ä¸€å®šï¼Œå¯èƒ½å¤šä¹Ÿå¯èƒ½å°‘ï¼Œå ä½ç¬¦éœ€è¦å’Œå‚æ•°ä¸€ä¸€å¯¹åº”ã€‚ <ul><li>è§£å†³ï¼šMybatisè‡ªåŠ¨å°†javaå¯¹è±¡æ˜ å°„è‡³sqlè¯­å¥ã€‚</li></ul></li><li>4ã€å¯¹ç»“æœé›†è§£æéº»çƒ¦ï¼Œsqlå˜åŒ–å¯¼è‡´è§£æä»£ç å˜åŒ–ï¼Œä¸”è§£æå‰éœ€è¦éå†ï¼Œå¦‚æœèƒ½å°†æ•°æ®åº“è®°å½•å°è£…æˆpojoå¯¹è±¡è§£ææ¯”è¾ƒæ–¹ä¾¿ã€‚ <ul><li>è§£å†³ï¼šMybatisè‡ªåŠ¨å°†sqlæ‰§è¡Œç»“æœæ˜ å°„è‡³javaå¯¹è±¡ã€‚</li></ul></li></ul><h2 id="mybatis-å’Œ-hibernate-æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#mybatis-å’Œ-hibernate-æœ‰ä»€ä¹ˆåŒºåˆ«"><span><strong>MyBatis å’Œ Hibernate æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></span></a></h2><p>ç­”æ¡ˆï¼š<br><strong>1ã€ç›¸åŒç‚¹</strong></p><ul><li>éƒ½æ˜¯å¯¹jdbcçš„å°è£…ï¼Œéƒ½æ˜¯åº”ç”¨äºæŒä¹…å±‚çš„æ¡†æ¶ã€‚</li></ul><p><strong>2ã€ä¸åŒç‚¹</strong></p><ul><li>æ˜ å°„å…³ç³» <ul><li>MyBatis æ˜¯ä¸€ä¸ªåŠè‡ªåŠ¨æ˜ å°„çš„æ¡†æ¶ï¼Œé…ç½®Javaå¯¹è±¡ä¸sqlè¯­å¥æ‰§è¡Œç»“æœçš„å¯¹åº”å…³ç³»ï¼Œå¤šè¡¨å…³è”å…³ç³»é…ç½®ç®€å•</li><li>Hibernate æ˜¯ä¸€ä¸ªå…¨è¡¨æ˜ å°„çš„æ¡†æ¶ï¼Œé…ç½®Javaå¯¹è±¡ä¸æ•°æ®åº“è¡¨çš„å¯¹åº”å…³ç³»ï¼Œå¤šè¡¨å…³è”å…³ç³»é…ç½®å¤æ‚</li></ul></li><li>SQLä¼˜åŒ–å’Œç§»æ¤æ€§ <ul><li>Hibernate å¯¹SQLè¯­å¥å°è£…ï¼Œæä¾›äº†æ—¥å¿—ã€ç¼“å­˜ã€çº§è”ï¼ˆçº§è”æ¯” MyBatis å¼ºå¤§ï¼‰ç­‰ç‰¹æ€§ï¼Œæ­¤å¤–è¿˜æä¾› HQLï¼ˆHibernate Query Languageï¼‰æ“ä½œæ•°æ®åº“ï¼Œæ•°æ®åº“æ— å…³æ€§æ”¯æŒå¥½ï¼Œä½†ä¼šå¤šæ¶ˆè€—æ€§èƒ½ã€‚å¦‚æœé¡¹ç›®éœ€è¦æ”¯æŒå¤šç§æ•°æ®åº“ï¼Œä»£ç å¼€å‘é‡å°‘ï¼Œä½†SQLè¯­å¥ä¼˜åŒ–å›°éš¾ã€‚</li><li>MyBatis éœ€è¦æ‰‹åŠ¨ç¼–å†™ SQLï¼Œæ”¯æŒåŠ¨æ€ SQLã€å¤„ç†åˆ—è¡¨ã€åŠ¨æ€ç”Ÿæˆè¡¨åã€æ”¯æŒå­˜å‚¨è¿‡ç¨‹ã€‚å¼€å‘å·¥ä½œé‡ç›¸å¯¹å¤§äº›ã€‚ç›´æ¥ä½¿ç”¨SQLè¯­å¥æ“ä½œæ•°æ®åº“ï¼Œä¸æ”¯æŒæ•°æ®åº“æ— å…³æ€§ï¼Œä½†sqlè¯­å¥ä¼˜åŒ–å®¹æ˜“ã€‚</li></ul></li></ul><h2 id="mybatis-çš„ä½¿ç”¨è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#mybatis-çš„ä½¿ç”¨è¿‡ç¨‹"><span><strong>MyBatis çš„ä½¿ç”¨è¿‡ç¨‹ï¼Ÿ</strong><br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>1ã€ åˆ›å»º SqlSessionFactoryã€‚å¯ä»¥ä»é…ç½®æˆ–è€…ç›´æ¥ç¼–ç æ¥åˆ›å»ºSqlSessionFactory</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>StrinString resource = &quot;org/mybatis/example/mybatis-config.xml&quot;;</span></span>
<span class="line"><span>InputStream inputStream = Resources.getResourceAsStream(resource);</span></span>
<span class="line"><span>SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€ é€šè¿‡SqlSessionFactoryåˆ›å»ºSqlSessionï¼ŒSqlSessionï¼ˆä¼šè¯ï¼‰å¯ä»¥ç†è§£ä¸ºç¨‹åºå’Œæ•°æ®åº“ä¹‹é—´çš„æ¡¥æ¢</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>SqlSession session = sqlSessionFactory.openSession();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>3ã€ é€šè¿‡sqlsessionæ‰§è¡Œæ•°æ®åº“æ“ä½œ</p><ul><li>å¯ä»¥é€šè¿‡ SqlSession å®ä¾‹æ¥ç›´æ¥æ‰§è¡Œå·²æ˜ å°„çš„ SQL è¯­å¥ï¼š</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>Blog blog = (Blog)session.selectOne(&quot;org.mybatis.example.BlogMapper.selectBlog&quot;, 101);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>æ›´å¸¸ç”¨çš„æ–¹å¼æ˜¯å…ˆè·å–Mapper(æ˜ å°„)ï¼Œç„¶åå†æ‰§è¡ŒSQLè¯­å¥ï¼š</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>BlogMapper mapper = session.getMapper(BlogMapper.class);</span></span>
<span class="line"><span>Blog blog = mapper.selectBlog(101);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>4ã€ è°ƒç”¨session.commit()æäº¤äº‹åŠ¡ã€‚å¦‚æœæ˜¯æ›´æ–°ã€åˆ é™¤è¯­å¥ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æäº¤ä¸€ä¸‹äº‹åŠ¡ã€‚<br>5ã€ è°ƒç”¨session.close()å…³é—­ä¼šè¯</p><h2 id="mybatis-ç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#mybatis-ç”Ÿå‘½å‘¨æœŸ"><span><strong>MyBatis ç”Ÿå‘½å‘¨æœŸï¼Ÿ</strong></span></a></h2><p>ç­”æ¡ˆï¼š<br>ä¸Šé¢æåˆ°äº†å‡ ä¸ªMyBatisçš„ç»„ä»¶ï¼Œä¸€èˆ¬è¯´çš„MyBatisç”Ÿå‘½å‘¨æœŸå°±æ˜¯è¿™äº›ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚<br>1ã€SqlSessionFactoryBuilder<br> ä¸€æ—¦åˆ›å»ºäº† SqlSessionFactoryï¼Œå°±ä¸å†éœ€è¦å®ƒäº†ã€‚å› æ­¤ SqlSessionFactoryBuilder å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸåªå­˜åœ¨äºæ–¹æ³•çš„å†…éƒ¨ã€‚<br>2ã€SqlSessionFactory<br> SqlSessionFactory æ˜¯ç”¨æ¥åˆ›å»ºSqlSessionçš„ï¼Œç›¸å½“äºä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± ï¼Œæ¯æ¬¡åˆ›å»ºSqlSessionFactoryéƒ½ä¼šä½¿ç”¨æ•°æ®åº“èµ„æºï¼Œå¤šæ¬¡åˆ›å»ºå’Œé”€æ¯æ˜¯å¯¹èµ„æºçš„æµªè´¹ã€‚æ‰€ä»¥SqlSessionFactoryæ˜¯åº”ç”¨çº§çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œä¸”åº”è¯¥æ˜¯å•ä¾‹çš„ã€‚<br>3ã€SqlSession<br> SqlSessionç›¸å½“äºJDBCä¸­çš„Connectionï¼ŒSqlSession çš„å®ä¾‹ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤æ˜¯ä¸èƒ½è¢«å…±äº«çš„ï¼Œæ‰€ä»¥å®ƒçš„æœ€ä½³çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€æ¬¡è¯·æ±‚æˆ–ä¸€ä¸ªæ–¹æ³•ã€‚<br>4ã€Mapper<br> æ˜ å°„å™¨æ˜¯ä¸€äº›ç»‘å®šSQLè¯­å¥çš„æ¥å£ã€‚æ˜ å°„å™¨æ¥å£çš„å®ä¾‹æ˜¯ä» SqlSession ä¸­è·å¾—çš„ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸåœ¨sqlsessionäº‹åŠ¡æ–¹æ³•ä¹‹å†…ï¼Œä¸€èˆ¬ä¼šæ§åˆ¶åœ¨æ–¹æ³•çº§ã€‚</p><blockquote><p>ğŸš„ MyBatisé€šå¸¸ä¹Ÿæ˜¯å’ŒSpringé›†æˆä½¿ç”¨ï¼ŒSpringå¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ›å»ºçº¿ç¨‹å®‰å…¨çš„ã€åŸºäºäº‹åŠ¡çš„ SqlSession å’Œæ˜ å°„å™¨ï¼Œå¹¶å°†å®ƒä»¬ç›´æ¥æ³¨å…¥åˆ°æˆ‘ä»¬çš„ bean ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒå®ƒä»¬çš„åˆ›å»ºè¿‡ç¨‹å’Œç”Ÿå‘½å‘¨æœŸ</p></blockquote><h2 id="æ¨¡ç³ŠæŸ¥è¯¢-like-è¯­å¥è¯¥æ€ä¹ˆå†™" tabindex="-1"><a class="header-anchor" href="#æ¨¡ç³ŠæŸ¥è¯¢-like-è¯­å¥è¯¥æ€ä¹ˆå†™"><span><strong>æ¨¡ç³ŠæŸ¥è¯¢ like è¯­å¥è¯¥æ€ä¹ˆå†™?</strong><br><br></span></a></h2><p>ç­”æ¡ˆï¼š</p><div align="left"><img src="http://offercome.cn/images/article/interview/interview/9-1.png" width="800px"></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>1 ã€â€™%\${question}%â€™ å¯èƒ½å¼•èµ·SQLæ³¨å…¥ï¼Œä¸æ¨è</span></span>
<span class="line"><span>2 ã€&quot;%&quot;#{question}&quot;%&quot; ï¼Œå› ä¸º#{â€¦}è§£ææˆsqlè¯­å¥æ—¶å€™ï¼Œä¼šåœ¨å˜é‡å¤–ä¾§è‡ªåŠ¨æ·»åŠ å•å¼•å·â€™ &#39;ï¼Œæ‰€ä»¥è¿™é‡Œ % éœ€è¦ä½¿ç”¨åŒå¼•å·&quot; &quot;ï¼Œä¸èƒ½ä½¿ç”¨å•å¼•å· â€™ &#39;ï¼Œä¸ç„¶ä¼šæŸ¥ä¸åˆ°ä»»ä½•ç»“æœã€‚</span></span>
<span class="line"><span>3 ã€CONCAT(â€™%â€™,#{question},â€™%â€™) ä½¿ç”¨CONCAT()å‡½æ•°ï¼ˆæ¨èï¼‰</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½" tabindex="-1"><a class="header-anchor" href="#æ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½"><span><strong>æ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Ÿ</strong><br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>1ã€Mybatisæ”¯æŒassociationå…³è”å¯¹è±¡å’Œcollectionå…³è”é›†åˆå¯¹è±¡çš„å»¶è¿ŸåŠ è½½ï¼ŒassociationæŒ‡çš„å°±æ˜¯ä¸€å¯¹ä¸€ï¼ŒcollectionæŒ‡çš„å°±æ˜¯ä¸€å¯¹å¤šæŸ¥è¯¢ã€‚åœ¨Mybatisé…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é…ç½®æ˜¯å¦å¯ç”¨å»¶è¿ŸåŠ è½½lazyLoadingEnabled=true|falseã€‚<br>2ã€å®ƒçš„åŸç†æ˜¯ï¼Œä½¿ç”¨CGLIBåˆ›å»ºç›®æ ‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼Œå½“è°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ï¼Œè¿›å…¥æ‹¦æˆªå™¨æ–¹æ³•ï¼Œæ¯”å¦‚è°ƒç”¨a.getB().getName()ï¼Œæ‹¦æˆªå™¨ invoke() æ–¹æ³•å‘ç° a.getB() æ˜¯nullå€¼ï¼Œé‚£ä¹ˆå°±ä¼šå•ç‹¬å‘é€äº‹å…ˆä¿å­˜å¥½çš„æŸ¥è¯¢å…³è”Bå¯¹è±¡çš„sqlï¼ŒæŠŠBæŸ¥è¯¢ä¸Šæ¥ï¼Œç„¶åè°ƒç”¨a.setB(b)ï¼Œäºæ˜¯açš„å¯¹è±¡bå±æ€§å°±æœ‰å€¼äº†ï¼Œæ¥ç€å®Œæˆa.getB().getName()æ–¹æ³•çš„è°ƒç”¨ã€‚è¿™å°±æ˜¯å»¶è¿ŸåŠ è½½çš„åŸºæœ¬åŸç†ã€‚<br>3ã€å½“ç„¶äº†ï¼Œä¸å…‰æ˜¯Mybatisï¼Œå‡ ä¹æ‰€æœ‰çš„åŒ…æ‹¬Hibernateï¼Œæ”¯æŒå»¶è¿ŸåŠ è½½çš„åŸç†éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><h2 id="å¦‚ä½•è·å–è‡ªåŠ¨ç”Ÿæˆçš„ä¸»é”®å€¼" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•è·å–è‡ªåŠ¨ç”Ÿæˆçš„ä¸»é”®å€¼"><span><strong>å¦‚ä½•è·å–è‡ªåŠ¨ç”Ÿæˆçš„ä¸»é”®å€¼?</strong><br><br></span></a></h2><p>ç­”æ¡ˆï¼š</p><ul><li>æ–°å¢æ ‡ç­¾ä¸­æ·»åŠ ï¼škeyProperty=&quot; ID &quot; å³å¯</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>&lt;insert id=&quot;insert&quot; useGeneratedKeys=&quot;true&quot; keyProperty=&quot;userId&quot; &gt;</span></span>
<span class="line"><span>    insert into user( </span></span>
<span class="line"><span>    user_name, user_password, create_time) </span></span>
<span class="line"><span>    values(#{userName}, #{userPassword} , #{createTime, jdbcType= TIMESTAMP})</span></span>
<span class="line"><span>&lt;/insert&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™æ—¶å€™å°±å¯ä»¥å®Œæˆå›å¡«ä¸»é”®</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>mapper.insert(user);</span></span>
<span class="line"><span>user.getId;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ”¯æŒåŠ¨æ€-sql-å—" tabindex="-1"><a class="header-anchor" href="#æ”¯æŒåŠ¨æ€-sql-å—"><span><strong>æ”¯æŒåŠ¨æ€ SQL å—ï¼Ÿ</strong></span></a></h2><p>ç­”æ¡ˆï¼š<br>Mybatis åŠ¨æ€ sql å¯ä»¥åœ¨ Xml æ˜ å°„æ–‡ä»¶å†…ï¼Œä»¥æ ‡ç­¾çš„å½¢å¼ç¼–å†™åŠ¨æ€ sqlï¼Œæ‰§è¡ŒåŸç† æ˜¯æ ¹æ®è¡¨è¾¾å¼çš„å€¼ å®Œæˆé€»è¾‘åˆ¤æ–­å¹¶åŠ¨æ€æ‹¼æ¥ sql çš„åŠŸèƒ½ã€‚<br>Mybatis æä¾›äº† 9 ç§åŠ¨æ€ sql æ ‡ç­¾ï¼štrim ã€ where ã€ set ã€foreach ã€if ã€ choose ã€ when ã€ otherwise ã€ bind</p><p>1ã€ifï¼Œæ ¹æ®æ¡ä»¶æ¥ç»„æˆwhereå­å¥</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>&lt;select id=&quot;findActiveBlogWithTitleLike&quot;</span></span>
<span class="line"><span>     resultType=&quot;Blog&quot;&gt;</span></span>
<span class="line"><span>  SELECT * FROM BLOG</span></span>
<span class="line"><span>  WHERE state = â€˜ACTIVEâ€™</span></span>
<span class="line"><span>  &lt;if test=&quot;title != null&quot;&gt;</span></span>
<span class="line"><span>    AND title like #{title}</span></span>
<span class="line"><span>  &lt;/if&gt;</span></span>
<span class="line"><span>&lt;/select&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€choose (when, otherwise)ï¼Œå’ŒJava ä¸­çš„ switch è¯­å¥æœ‰ç‚¹åƒ</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>&lt;select id=&quot;findActiveBlogLike&quot;</span></span>
<span class="line"><span>     resultType=&quot;Blog&quot;&gt;</span></span>
<span class="line"><span>  SELECT * FROM BLOG WHERE state = â€˜ACTIVEâ€™</span></span>
<span class="line"><span>  &lt;choose&gt;</span></span>
<span class="line"><span>    &lt;when test=&quot;title != null&quot;&gt;</span></span>
<span class="line"><span>      AND title like #{title}</span></span>
<span class="line"><span>    &lt;/when&gt;</span></span>
<span class="line"><span>    &lt;when test=&quot;author != null and author.name != null&quot;&gt;</span></span>
<span class="line"><span>      AND author_name like #{author.name}</span></span>
<span class="line"><span>    &lt;/when&gt;</span></span>
<span class="line"><span>    &lt;otherwise&gt;</span></span>
<span class="line"><span>      AND featured = 1</span></span>
<span class="line"><span>    &lt;/otherwise&gt;</span></span>
<span class="line"><span>  &lt;/choose&gt;</span></span>
<span class="line"><span>&lt;/select&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€foreachï¼Œç”¨æ¥å¾ªç¯çš„ï¼Œå¯ä»¥å¯¹é›†åˆè¿›è¡Œéå†</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>&lt;select id=&quot;selectPostIn&quot; resultType=&quot;domain.blog.Post&quot;&gt;</span></span>
<span class="line"><span>  SELECT *</span></span>
<span class="line"><span>  FROM POST P</span></span>
<span class="line"><span>  &lt;where&gt;</span></span>
<span class="line"><span>    &lt;foreach item=&quot;item&quot; index=&quot;index&quot; collection=&quot;list&quot;</span></span>
<span class="line"><span>        open=&quot;ID in (&quot; separator=&quot;,&quot; close=&quot;)&quot; nullable=&quot;true&quot;&gt;</span></span>
<span class="line"><span>          #{item}</span></span>
<span class="line"><span>    &lt;/foreach&gt;</span></span>
<span class="line"><span>  &lt;/where&gt;</span></span>
<span class="line"><span>&lt;/select&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="xml-æ˜ å°„æ–‡ä»¶ä¸­æœ‰å“ªäº›æ ‡ç­¾" tabindex="-1"><a class="header-anchor" href="#xml-æ˜ å°„æ–‡ä»¶ä¸­æœ‰å“ªäº›æ ‡ç­¾"><span><strong>Xml æ˜ å°„æ–‡ä»¶ä¸­æœ‰å“ªäº›æ ‡ç­¾ï¼Ÿ</strong><br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>é™¤äº†å¸¸è§çš„**select | insert | update | delete æ ‡ç­¾ä¹‹å¤–ï¼Œè¿˜æœ‰ ** <code>&lt;resultMap&gt;ã€&lt;parameterMap&gt;ã€&lt;sql&gt;ã€&lt;include&gt;ã€&lt;selectKey&gt;</code>ï¼ŒåŠ ä¸ŠåŠ¨æ€ sql çš„ 9 ä¸ªæ ‡ç­¾</p><h2 id="ä¸åŒxmlæ˜ å°„æ–‡ä»¶idæ˜¯å¦å¯ä»¥é‡å¤" tabindex="-1"><a class="header-anchor" href="#ä¸åŒxmlæ˜ å°„æ–‡ä»¶idæ˜¯å¦å¯ä»¥é‡å¤"><span>ä¸åŒxmlæ˜ å°„æ–‡ä»¶idæ˜¯å¦å¯ä»¥é‡å¤ï¼Ÿ<br><br></span></a></h2><p>ç­”æ¡ˆï¼š <br>ä¸åŒçš„xmlæ˜ å°„æ–‡ä»¶ï¼Œå¦‚æœé…ç½®äº† namespaceï¼Œé‚£ä¹ˆidå¯ä»¥é‡å¤ï¼›å¦‚æœæ²¡æœ‰é…ç½® namespaceï¼Œé‚£ä¹ˆidä¸èƒ½é‡å¤ã€‚<br>åŸå›  namespace+id ä½œä¸º<code>Map&lt;Stringï¼ŒMapperStatement&gt;</code>çš„keyä½¿ç”¨ï¼Œå¦‚æœæ²¡æœ‰namespaceï¼Œå°±å‰©ä¸‹idï¼Œé‚£ä¹ˆidé‡å¤ä¼šå¯¼è‡´æ•°æ®äº’ç›¸è¦†ç›–ã€‚æœ‰äº†namespaceï¼Œè‡ªç„¶idå°±å¯ä»¥é‡å¤ï¼Œnamespaceä¸åŒï¼Œnamespace+idè‡ªç„¶ä¹Ÿä¸åŒã€‚</p><h2 id="mybatis-çš„ä¸€çº§ã€äºŒçº§ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#mybatis-çš„ä¸€çº§ã€äºŒçº§ç¼“å­˜"><span><strong>Mybatis çš„ä¸€çº§ã€äºŒçº§ç¼“å­˜ï¼Ÿ</strong><br><br></span></a></h2><p>ç­”æ¡ˆ<br>Mybatis é‡Œé¢è®¾è®¡äº†ä¸¤çº§ç¼“å­˜æ¥æå‡æ•°æ®çš„æ£€ç´¢æ•ˆç‡ï¼Œé¿å…æ¯æ¬¡æ•°æ®è®¿é—®éƒ½å»æŸ¥è¯¢æ•°æ®åº“ã€‚<br></p><div align="left"><img src="http://offercome.cn/images/article/interview/interview/9-2.png" width="800px"></div><p><br>1ã€ä¸€çº§ç¼“å­˜: åŸºäº PerpetualCache çš„ HashMap æœ¬åœ°ç¼“å­˜ï¼Œå…¶å­˜å‚¨ä½œç”¨åŸŸä¸º Sessionï¼Œå„ä¸ªSqlSessionä¹‹é—´çš„ç¼“å­˜ç›¸äº’éš”ç¦»ã€‚å½“ Session flush æˆ– close ä¹‹åï¼Œè¯¥ Session ä¸­çš„æ‰€æœ‰ Cache å°± å°†æ¸…ç©ºï¼Œé»˜è®¤æ‰“å¼€ä¸€çº§ç¼“å­˜ã€‚<br>2ã€äºŒçº§ç¼“å­˜ä¸ä¸€çº§ç¼“å­˜å…¶æœºåˆ¶ç›¸åŒï¼Œé»˜è®¤ä¹Ÿæ˜¯é‡‡ç”¨ PerpetualCacheï¼ŒHashMap å­˜å‚¨ï¼Œä¸åŒä¹‹å¤„åœ¨äºå…¶å­˜å‚¨ä½œç”¨åŸŸä¸º Mapper(Namespace)ï¼Œå¯ä»¥åœ¨å¤šä¸ªSqlSessionä¹‹é—´å…±äº«ï¼Œå¹¶ä¸”å¯è‡ªå®šä¹‰å­˜å‚¨æºï¼Œå¦‚ Ehcacheã€‚é»˜è®¤ä¸æ‰“å¼€äºŒçº§ç¼“å­˜ï¼Œè¦å¼€å¯äºŒçº§ç¼“å­˜ï¼Œä½¿ç”¨äºŒçº§ç¼“å­˜å±æ€§ç±»éœ€è¦å®ç°Serializableåºåˆ—åŒ–æ¥å£(å¯ç”¨æ¥ä¿å­˜å¯¹è±¡çš„çŠ¶æ€)ï¼Œå¯åœ¨å®ƒçš„æ˜ å°„æ–‡ä»¶ä¸­é…ç½®ã€‚<br>3ã€å¯¹äºç¼“å­˜æ•°æ®æ›´æ–°æœºåˆ¶ï¼Œå½“æŸä¸€ä¸ªä½œç”¨åŸŸ(ä¸€çº§ç¼“å­˜ Session/äºŒçº§ç¼“å­˜Namespaces)çš„è¿›è¡Œäº† C/U/D æ“ä½œåï¼Œé»˜è®¤è¯¥ä½œç”¨åŸŸä¸‹æ‰€æœ‰ select ä¸­çš„ç¼“å­˜å°†è¢« clearã€‚</p><h2 id="mybatisçš„å·¥ä½œåŸç†" tabindex="-1"><a class="header-anchor" href="#mybatisçš„å·¥ä½œåŸç†"><span><strong>MyBatisçš„å·¥ä½œåŸç†ï¼Ÿ</strong><br><br></span></a></h2><p>ç­”æ¡ˆï¼š</p><ol><li>è¯»å– MyBatis é…ç½®æ–‡ä»¶â€”â€”mybatis-config.xml ã€åŠ è½½æ˜ å°„æ–‡ä»¶â€”â€”æ˜ å°„æ–‡ä»¶å³ SQL æ˜ å°„æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­é…ç½®äº†æ“ä½œæ•°æ®åº“çš„ SQL è¯­å¥ã€‚æœ€åç”Ÿæˆä¸€ä¸ªé…ç½®å¯¹è±¡ã€‚</li><li>æ„é€ ä¼šè¯å·¥å‚ï¼šé€šè¿‡ MyBatis çš„ç¯å¢ƒç­‰é…ç½®ä¿¡æ¯æ„å»ºä¼šè¯å·¥å‚ SqlSessionFactoryã€‚</li><li>åˆ›å»ºä¼šè¯å¯¹è±¡ï¼šç”±ä¼šè¯å·¥å‚åˆ›å»º SqlSession å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸­åŒ…å«äº†æ‰§è¡Œ SQL è¯­å¥çš„æ‰€æœ‰æ–¹æ³•ã€‚</li><li>Executor æ‰§è¡Œå™¨ï¼šMyBatis åº•å±‚å®šä¹‰äº†ä¸€ä¸ª Executor æ¥å£æ¥æ“ä½œæ•°æ®åº“ï¼Œå®ƒå°†æ ¹æ® SqlSession ä¼ é€’çš„å‚æ•°åŠ¨æ€åœ°ç”Ÿæˆéœ€è¦æ‰§è¡Œçš„ SQL è¯­å¥ï¼ŒåŒæ—¶è´Ÿè´£æŸ¥è¯¢ç¼“å­˜çš„ç»´æŠ¤ã€‚</li><li>StatementHandlerï¼šæ•°æ®åº“ä¼šè¯å™¨ï¼Œä¸²è”èµ·å‚æ•°æ˜ å°„çš„å¤„ç†å’Œè¿è¡Œç»“æœæ˜ å°„çš„å¤„ç†ã€‚</li><li>å‚æ•°å¤„ç†ï¼šå¯¹è¾“å…¥å‚æ•°çš„ç±»å‹è¿›è¡Œå¤„ç†ï¼Œå¹¶é¢„ç¼–è¯‘ã€‚</li><li>ç»“æœå¤„ç†ï¼šå¯¹è¿”å›ç»“æœçš„ç±»å‹è¿›è¡Œå¤„ç†ï¼Œæ ¹æ®å¯¹è±¡æ˜ å°„è§„åˆ™ï¼Œè¿”å›ç›¸åº”çš„å¯¹è±¡ã€‚</li></ol><h2 id="ä¸ºä»€ä¹ˆ-mapper-æ¥å£ä¸éœ€è¦å®ç°ç±»" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-mapper-æ¥å£ä¸éœ€è¦å®ç°ç±»"><span><strong>ä¸ºä»€ä¹ˆ Mapper æ¥å£ä¸éœ€è¦å®ç°ç±»ï¼Ÿ</strong></span></a></h2><p>ç­”æ¡ˆï¼š<br>**ä¸»è¦æ˜¯å€ŸåŠ©äº åŠ¨æ€ä»£ç†æ¥å®ç°ã€‚**æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è·å–Mapperçš„è¿‡ç¨‹ï¼š</p><ul><li>å®šä¹‰çš„Mapperæ¥å£æ²¡æœ‰å®ç°ç±»ï¼ŒMapper æ˜ å°„å…¶å®æ˜¯é€šè¿‡<strong>åŠ¨æ€ä»£ç†</strong>å®ç°çš„ã€‚ä¸ƒæ‹å…«ç»•åœ°è¿›å»çœ‹ä¸€ä¸‹ï¼Œå‘ç°è·å–Mapperçš„è¿‡ç¨‹ï¼Œé¦–å…ˆè·å–Mapperä»£ç†å·¥å‚ MapperProxyFactory</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    public &lt;T&gt; T getMapper(Class&lt;T&gt; type, SqlSession sqlSession) {</span></span>
<span class="line"><span>        MapperProxyFactory&lt;T&gt; mapperProxyFactory = (MapperProxyFactory)this.knownMappers.get(type);</span></span>
<span class="line"><span>        if (mapperProxyFactory == null) {</span></span>
<span class="line"><span>            throw new BindingException(&quot;Type &quot; + type + &quot; is not known to the MapperRegistry.&quot;);</span></span>
<span class="line"><span>        } else {</span></span>
<span class="line"><span>            try {</span></span>
<span class="line"><span>                return mapperProxyFactory.newInstance(sqlSession);</span></span>
<span class="line"><span>            } catch (Exception var5) {</span></span>
<span class="line"><span>                throw new BindingException(&quot;Error getting mapper instance. Cause: &quot; + var5, var5);</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>public class MapperProxyFactory&lt;T&gt; {</span></span>
<span class="line"><span>    private final Class&lt;T&gt; mapperInterface;</span></span>
<span class="line"><span>    â€¦â€¦</span></span>
<span class="line"><span>    protected T newInstance(MapperProxy&lt;T&gt; mapperProxy) {</span></span>
<span class="line"><span>        return Proxy.newProxyInstance(this.mapperInterface.getClassLoader(), new Class[]{this.mapperInterface}, mapperProxy);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    public T newInstance(SqlSession sqlSession) {</span></span>
<span class="line"><span>        MapperProxy&lt;T&gt; mapperProxy = new MapperProxy(sqlSession, this.mapperInterface, this.methodCache);</span></span>
<span class="line"><span>        return this.newInstance(mapperProxy);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>é€šè¿‡Proxy.newProxyInstance ä¸º Mapperæ¥å£åˆ›å»ºä¸€ä¸ª **åŠ¨æ€ä»£ç†å¯¹è±¡ MapperProxyï¼Œ**æ‰€æœ‰çš„æ–¹æ³•ç»´æŠ¤åœ¨ä¸€ä¸ª Map&lt;Method, MapperMethod&gt; methodCache é›†åˆä¸­</li><li>å½“æˆ‘ä»¬å¯¹ Mapperæ¥å£ æŸä¸ªæ–¹æ³•ï¼ˆå¦‚ï¼šqueryUserByIdï¼‰è°ƒç”¨æ—¶å€™ï¼Œè§¦å‘åŠ¨æ€ä»£ç† çš„ invoke æ–¹æ³•</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        if (Object.class.equals(method.getDeclaringClass())) {</span></span>
<span class="line"><span>            return method.invoke(this, args);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        if (this.isDefaultMethod(method)) {</span></span>
<span class="line"><span>            return this.invokeDefaultMethod(proxy, method, args);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    } catch (Throwable var5) {</span></span>
<span class="line"><span>        throw ExceptionUtil.unwrapThrowable(var5);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    MapperMethod mapperMethod = this.cachedMapperMethod(method);</span></span>
<span class="line"><span>    return mapperMethod.execute(this.sqlSession, args);</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>MapperMethodé‡Œçš„excuteæ–¹æ³•ï¼ŒçœŸæ­£å»æ‰§è¡Œsqlã€‚å…¶å®ç»•ä¸€åœˆï¼Œæœ€ç»ˆæ˜¯é€šè¿‡SqlSessionçš„å®ä¾‹å»è¿è¡Œå¯¹è±¡çš„sqlã€‚</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span> public Object execute(SqlSession sqlSession, Object[] args) {</span></span>
<span class="line"><span>    Object param;</span></span>
<span class="line"><span>    Object result;</span></span>
<span class="line"><span>    switch(this.command.getType()) {</span></span>
<span class="line"><span>    case INSERT:</span></span>
<span class="line"><span>        param = this.method.convertArgsToSqlCommandParam(args);</span></span>
<span class="line"><span>        result = this.rowCountResult(sqlSession.insert(this.command.getName(), param));</span></span>
<span class="line"><span>        break;</span></span>
<span class="line"><span>    case UPDATE:</span></span>
<span class="line"><span>        param = this.method.convertArgsToSqlCommandParam(args);</span></span>
<span class="line"><span>        result = this.rowCountResult(sqlSession.update(this.command.getName(), param));</span></span>
<span class="line"><span>        break;</span></span>
<span class="line"><span>    case DELETE:</span></span>
<span class="line"><span>        param = this.method.convertArgsToSqlCommandParam(args);</span></span>
<span class="line"><span>        result = this.rowCountResult(sqlSession.delete(this.command.getName(), param));</span></span>
<span class="line"><span>        break;</span></span>
<span class="line"><span>    case SELECT:</span></span>
<span class="line"><span>        if (this.method.returnsVoid() &amp;&amp; this.method.hasResultHandler()) {</span></span>
<span class="line"><span>            this.executeWithResultHandler(sqlSession, args);</span></span>
<span class="line"><span>            result = null;</span></span>
<span class="line"><span>        } else if (this.method.returnsMany()) {</span></span>
<span class="line"><span>            result = this.executeForMany(sqlSession, args);</span></span>
<span class="line"><span>        } else if (this.method.returnsMap()) {</span></span>
<span class="line"><span>            result = this.executeForMap(sqlSession, args);</span></span>
<span class="line"><span>        } else if (this.method.returnsCursor()) {</span></span>
<span class="line"><span>            result = this.executeForCursor(sqlSession, args);</span></span>
<span class="line"><span>        } else {</span></span>
<span class="line"><span>            param = this.method.convertArgsToSqlCommandParam(args);</span></span>
<span class="line"><span>            result = sqlSession.selectOne(this.command.getName(), param);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        break;</span></span>
<span class="line"><span>    case FLUSH:</span></span>
<span class="line"><span>        result = sqlSession.flushStatements();</span></span>
<span class="line"><span>        break;</span></span>
<span class="line"><span>   ã€‚ã€‚ã€‚ã€‚çœç•¥</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mybatis-éƒ½æœ‰å“ªäº›-executor-æ‰§è¡Œå™¨" tabindex="-1"><a class="header-anchor" href="#mybatis-éƒ½æœ‰å“ªäº›-executor-æ‰§è¡Œå™¨"><span><strong>Mybatis éƒ½æœ‰å“ªäº› Executor æ‰§è¡Œå™¨ï¼Ÿ</strong></span></a></h2><p>ç­”æ¡ˆï¼š<br>Mybatisæœ‰ä¸‰ç§åŸºæœ¬çš„Executoræ‰§è¡Œå™¨ï¼ŒSimpleExecutorã€ReuseExecutorã€BatchExecutorã€‚</p><ul><li><strong>SimpleExecutor</strong>ï¼šæ¯æ‰§è¡Œä¸€æ¬¡updateæˆ–selectï¼Œå°±å¼€å¯ä¸€ä¸ªStatementå¯¹è±¡ï¼Œç”¨å®Œç«‹åˆ»å…³é—­Statementå¯¹è±¡ã€‚</li><li><strong>ReuseExecutor</strong>ï¼šæ‰§è¡Œupdateæˆ–selectï¼Œä»¥sqlä½œä¸ºkeyæŸ¥æ‰¾Statementå¯¹è±¡ï¼Œå­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±åˆ›å»ºï¼Œç”¨å®Œåï¼Œä¸å…³é—­Statementå¯¹è±¡ï¼Œè€Œæ˜¯æ”¾ç½®äºMap&lt;String, Statement&gt;å†…ï¼Œä¾›ä¸‹ä¸€æ¬¡ä½¿ç”¨ã€‚ç®€è¨€ä¹‹ï¼Œå°±æ˜¯é‡å¤ä½¿ç”¨Statementå¯¹è±¡ã€‚</li><li><strong>BatchExecutor</strong>ï¼šæ‰§è¡Œupdateï¼ˆæ²¡æœ‰selectï¼ŒJDBCæ‰¹å¤„ç†ä¸æ”¯æŒselectï¼‰ï¼Œå°†æ‰€æœ‰sqléƒ½æ·»åŠ åˆ°æ‰¹å¤„ç†ä¸­ï¼ˆaddBatch()ï¼‰ï¼Œç­‰å¾…ç»Ÿä¸€æ‰§è¡Œï¼ˆexecuteBatch()ï¼‰ï¼Œå®ƒç¼“å­˜äº†å¤šä¸ªStatementå¯¹è±¡ï¼Œæ¯ä¸ªStatementå¯¹è±¡éƒ½æ˜¯addBatch()å®Œæ¯•åï¼Œç­‰å¾…é€ä¸€æ‰§è¡ŒexecuteBatch()æ‰¹å¤„ç†ã€‚ä¸JDBCæ‰¹å¤„ç†ç›¸åŒã€‚</li></ul><h2 id="mybatis-æ’ä»¶è¿è¡ŒåŸç†" tabindex="-1"><a class="header-anchor" href="#mybatis-æ’ä»¶è¿è¡ŒåŸç†"><span><strong>Mybatis æ’ä»¶è¿è¡ŒåŸç†ï¼Ÿ</strong><br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>Mybatis å¯ä»¥ç¼–å†™é’ˆå¯¹ ParameterHandlerã€ResultSetHandlerã€StatementHandlerã€Executor 4ä¸ªæ¥å£çš„æ’ä»¶ï¼Œæ’ä»¶çš„åŸç†å°±æ˜¯åœ¨è¿™å››å¤§å¯¹è±¡è°ƒåº¦çš„æ—¶å€™ï¼Œæ’å…¥ä¸€äº›æˆ‘æˆ‘ä»¬è‡ªå·±çš„ä»£ç ã€‚</p><p>Mybatis ä½¿ç”¨JDKçš„åŠ¨æ€ä»£ç†ï¼Œä¸ºç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†å¯¹è±¡ã€‚å®ƒæä¾›äº†ä¸€ä¸ªå·¥å…·ç±»Pluginï¼Œå®ç°äº†InvocationHandleræ¥å£ã€‚<br></p><div align="left"><img src="http://offercome.cn/images/article/interview/interview/9-3.png" width="800px"></div><p><br>ä½¿ç”¨Pluginç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡åœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œå°±ä¼šè¿›å…¥invokeæ–¹æ³•ï¼Œåœ¨invokeæ–¹æ³•ä¸­ï¼Œå¦‚æœå­˜åœ¨ç­¾åçš„æ‹¦æˆªæ–¹æ³•ï¼Œæ’ä»¶çš„interceptæ–¹æ³•å°±ä¼šåœ¨è¿™é‡Œè¢«æˆ‘ä»¬è°ƒç”¨ï¼Œç„¶åå°±è¿”å›ç»“æœã€‚å¦‚æœä¸å­˜åœ¨ç­¾åæ–¹æ³•ï¼Œé‚£ä¹ˆå°†ç›´æ¥åå°„è°ƒç”¨æˆ‘ä»¬è¦æ‰§è¡Œçš„æ–¹æ³•ã€‚</p><h2 id="å¦‚ä½•ç¼–å†™ä¸€ä¸ªæ’ä»¶" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ç¼–å†™ä¸€ä¸ªæ’ä»¶"><span><strong>å¦‚ä½•ç¼–å†™ä¸€ä¸ªæ’ä»¶ï¼Ÿ</strong></span></a></h2><p>ç­”æ¡ˆï¼š<br>æˆ‘ä»¬è‡ªå·±ç¼–å†™MyBatis æ’ä»¶ï¼Œåªéœ€è¦å®ç°æ‹¦æˆªå™¨æ¥å£ Interceptor (org.apache.ibatis. plugin Interceptor ï¼‰ï¼Œåœ¨å®ç°ç±»ä¸­å¯¹æ‹¦æˆªå¯¹è±¡å’Œæ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p><ul><li>å®ç°Mybatisçš„Interceptoræ¥å£å¹¶é‡å†™intercept()æ–¹æ³•</li><li>è¿™é‡Œæˆ‘ä»¬åªæ˜¯åœ¨ç›®æ ‡å¯¹è±¡æ‰§è¡Œç›®æ ‡æ–¹æ³•çš„å‰åè¿›è¡Œäº†æ‰“å°ï¼›</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>public class MyInterceptor implements Interceptor {</span></span>
<span class="line"><span>    Properties props=null;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>    public Object intercept(Invocation invocation) throws Throwable {</span></span>
<span class="line"><span>        System.out.println(&quot;beforeâ€¦â€¦&quot;);</span></span>
<span class="line"><span>        //å¦‚æœå½“å‰ä»£ç†çš„æ˜¯ä¸€ä¸ªéä»£ç†å¯¹è±¡ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨çœŸå®æ‹¦æˆªå¯¹è±¡çš„æ–¹æ³•</span></span>
<span class="line"><span>        // å¦‚æœä¸æ˜¯å®ƒå°±ä¼šè°ƒç”¨ä¸‹ä¸ªæ’ä»¶ä»£ç†å¯¹è±¡çš„invokeæ–¹æ³•</span></span>
<span class="line"><span>        Object obj=invocation.proceed();</span></span>
<span class="line"><span>        System.out.println(&quot;afterâ€¦â€¦&quot;);</span></span>
<span class="line"><span>        return obj;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ç„¶åå†ç»™æ’ä»¶ç¼–å†™æ³¨è§£ï¼Œç¡®å®šè¦æ‹¦æˆªçš„å¯¹è±¡ï¼Œè¦æ‹¦æˆªçš„æ–¹æ³•</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>@Intercepts({@Signature(</span></span>
<span class="line"><span>        type = Executor.class,  //ç¡®å®šè¦æ‹¦æˆªçš„å¯¹è±¡</span></span>
<span class="line"><span>        method = &quot;update&quot;,        //ç¡®å®šè¦æ‹¦æˆªçš„æ–¹æ³•</span></span>
<span class="line"><span>        args = {MappedStatement.class,Object.class}   //æ‹¦æˆªæ–¹æ³•çš„å‚æ•°</span></span>
<span class="line"><span>)})</span></span>
<span class="line"><span>public class MyInterceptor implements Interceptor {</span></span>
<span class="line"><span>    Properties props=null;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>    public Object intercept(Invocation invocation) throws Throwable {</span></span>
<span class="line"><span>        System.out.println(&quot;beforeâ€¦â€¦&quot;);</span></span>
<span class="line"><span>        //å¦‚æœå½“å‰ä»£ç†çš„æ˜¯ä¸€ä¸ªéä»£ç†å¯¹è±¡ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨çœŸå®æ‹¦æˆªå¯¹è±¡çš„æ–¹æ³•</span></span>
<span class="line"><span>        // å¦‚æœä¸æ˜¯å®ƒå°±ä¼šè°ƒç”¨ä¸‹ä¸ªæ’ä»¶ä»£ç†å¯¹è±¡çš„invokeæ–¹æ³•</span></span>
<span class="line"><span>        Object obj=invocation.proceed();</span></span>
<span class="line"><span>        System.out.println(&quot;afterâ€¦â€¦&quot;);</span></span>
<span class="line"><span>        return obj;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æœ€åï¼Œåœ¨ MyBatisé…ç½®æ–‡ä»¶é‡Œé¢é…ç½®æ’ä»¶</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>&lt;plugins&gt;</span></span>
<span class="line"><span>    &lt;plugin interceptor=&quot;xxx.MyPlugin&quot;&gt;</span></span>
<span class="line"><span>       &lt;property name=&quot;dbType&quot;,value=&quot;mysql&quot;/&gt;</span></span>
<span class="line"><span>    &lt;/plugin&gt;</span></span>
<span class="line"><span>&lt;/plugins&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mybatis-å¦‚ä½•è¿›è¡Œåˆ†é¡µ" tabindex="-1"><a class="header-anchor" href="#mybatis-å¦‚ä½•è¿›è¡Œåˆ†é¡µ"><span><strong>MyBatis å¦‚ä½•è¿›è¡Œåˆ†é¡µï¼Ÿ</strong><br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>Mybatisä½¿ç”¨RowBoundså¯¹è±¡è¿›è¡Œåˆ†é¡µï¼Œå®ƒæ˜¯é’ˆå¯¹ResultSetç»“æœé›†æ‰§è¡Œçš„å†…å­˜åˆ†é¡µï¼Œè€Œéç‰©ç†åˆ†é¡µï¼Œå¯ä»¥åœ¨sqlå†…ç›´æ¥ä¹¦å†™å¸¦æœ‰ç‰©ç†åˆ†é¡µçš„å‚æ•°æ¥å®Œæˆç‰©ç†åˆ†é¡µåŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åˆ†é¡µæ’ä»¶æ¥å®Œæˆç‰©ç†åˆ†é¡µã€‚</p><h2 id="åˆ†é¡µæ’ä»¶çš„åŸç†æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#åˆ†é¡µæ’ä»¶çš„åŸç†æ˜¯ä»€ä¹ˆ"><span><strong>åˆ†é¡µæ’ä»¶çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</strong><br><br></span></a></h2><p>ç­”æ¡ˆï¼š <br>åˆ†é¡µæ’ä»¶çš„åŸºæœ¬åŸç†æ˜¯ä½¿ç”¨Mybatisæä¾›çš„æ’ä»¶æ¥å£ï¼Œå®ç°è‡ªå®šä¹‰æ’ä»¶ï¼Œåœ¨æ’ä»¶çš„æ‹¦æˆªæ–¹æ³•å†…æ‹¦æˆªå¾…æ‰§è¡Œçš„sqlï¼Œç„¶åé‡å†™sqlï¼Œæ ¹æ®dialectæ–¹è¨€ï¼Œæ·»åŠ å¯¹åº”çš„ç‰©ç†åˆ†é¡µè¯­å¥å’Œç‰©ç†åˆ†é¡µå‚æ•°ã€‚</p><h2 id="mybatis-çš„-xml-æ˜ å°„æ–‡ä»¶ä¸­-ä¸åŒçš„-xml-æ˜ å°„æ–‡ä»¶-id-æ˜¯å¦å¯ä»¥é‡å¤" tabindex="-1"><a class="header-anchor" href="#mybatis-çš„-xml-æ˜ å°„æ–‡ä»¶ä¸­-ä¸åŒçš„-xml-æ˜ å°„æ–‡ä»¶-id-æ˜¯å¦å¯ä»¥é‡å¤"><span><strong>Mybatis çš„ Xml æ˜ å°„æ–‡ä»¶ä¸­ï¼Œä¸åŒçš„ Xml æ˜ å°„æ–‡ä»¶ï¼Œid æ˜¯å¦å¯ä»¥é‡å¤ï¼Ÿ</strong><br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>ä¸åŒçš„ Xml æ˜ å°„æ–‡ä»¶ï¼Œå¦‚æœé…ç½®äº† namespaceï¼Œé‚£ä¹ˆ id å¯ä»¥é‡å¤ï¼›å¦‚æœæ²¡æœ‰é…ç½® namespaceï¼Œé‚£ä¹ˆ id ä¸èƒ½é‡å¤ï¼›<br>åŸå› å°±æ˜¯ namespace+id ä½œä¸º Mapçš„ keyä½¿ç”¨çš„ï¼Œå¦‚æœæ²¡æœ‰ namespaceï¼Œå°±å‰©ä¸‹ idï¼Œé‚£ä¹ˆï¼Œid é‡å¤ä¼šå¯¼è‡´æ•°æ®äº’ç›¸è¦†ç›–ã€‚æœ‰äº† namespaceï¼Œè‡ªç„¶ id å°±å¯ä»¥é‡å¤ï¼Œnamespace ä¸åŒï¼Œnamespace+id è‡ªç„¶ä¹Ÿå°±ä¸åŒã€‚</p><h2 id="mapper-æ¥å£è°ƒç”¨æ—¶æœ‰å“ªäº›è¦æ±‚" tabindex="-1"><a class="header-anchor" href="#mapper-æ¥å£è°ƒç”¨æ—¶æœ‰å“ªäº›è¦æ±‚"><span><strong>Mapper æ¥å£è°ƒç”¨æ—¶æœ‰å“ªäº›è¦æ±‚ï¼Ÿ</strong><br><br></span></a></h2><p>ç­”æ¡ˆï¼š</p><ol><li>Mapper æ¥å£æ–¹æ³•åå’Œ mapper.xml ä¸­å®šä¹‰çš„æ¯ä¸ª sql çš„ id ç›¸åŒï¼›</li><li>Mapper æ¥å£æ–¹æ³•çš„è¾“å…¥å‚æ•°ç±»å‹å’Œ mapper.xml ä¸­å®šä¹‰çš„æ¯ä¸ª sql çš„ parameterType çš„ç±»å‹ç›¸åŒï¼›</li><li>Mapper æ¥å£æ–¹æ³•çš„è¾“å‡ºå‚æ•°ç±»å‹å’Œ mapper.xml ä¸­å®šä¹‰çš„æ¯ä¸ª sql çš„ resultType çš„ç±»å‹ç›¸åŒï¼›</li><li>Mapper.xml æ–‡ä»¶ä¸­çš„ namespace å³æ˜¯ mapper æ¥å£çš„ç±»è·¯å¾„ã€‚</li></ol><h2 id="mybatis-å¼•å…¥å“ªäº›è®¾è®¡æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#mybatis-å¼•å…¥å“ªäº›è®¾è®¡æ¨¡å¼"><span>Mybatis å¼•å…¥å“ªäº›è®¾è®¡æ¨¡å¼?<br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>1ã€Builderæ¨¡å¼<br>å¦‚ï¼šSqlSessionFactoryBuilderã€XMLConfigBuilderã€XMLMapperBuilderã€XMLStatementBuilderã€CacheBuilder<br>2ã€å·¥å‚æ¨¡å¼<br>å¦‚ï¼šSqlSessionFactoryã€ObjectFactoryã€MapperProxyFactory<br>3ã€å•ä¾‹æ¨¡å¼<br>å¦‚ï¼šErrorContextå’ŒLogFactory<br>4ã€ä»£ç†æ¨¡å¼<br>Mybatiså®ç°çš„æ ¸å¿ƒï¼Œæ¯”å¦‚ MapperProxyã€ConnectionLoggerï¼Œç”¨çš„jdkçš„åŠ¨æ€ä»£ç†ï¼›è¿˜æœ‰executor.loaderåŒ…ä½¿ç”¨äº†cglibæˆ–è€…javassistè¾¾åˆ°å»¶è¿ŸåŠ è½½çš„æ•ˆæœï¼›<br>5ã€ç»„åˆæ¨¡å¼<br>å¦‚ï¼šSqlNodeå’Œå„ä¸ªå­ç±»ChooseSqlNodeç­‰<br>6ã€æ¨¡æ¿æ¨¡å¼<br>å¦‚ï¼šBaseExecutorå’ŒSimpleExecutorï¼Œè¿˜æœ‰BaseTypeHandlerå’Œæ‰€æœ‰çš„å­ç±»ä¾‹å¦‚IntegerTypeHandler<br>7ã€é€‚é…å™¨æ¨¡å¼<br>å¦‚ï¼šLogçš„Mybatisæ¥å£å’Œå®ƒå¯¹jdbcã€log4jç­‰å„ç§æ—¥å¿—æ¡†æ¶çš„é€‚é…å®ç°<br>8ã€è£…é¥°è€…æ¨¡å¼<br>å¦‚ï¼šCacheåŒ…ä¸­çš„cache.decoratorså­åŒ…ä¸­ç­‰å„ä¸ªè£…é¥°è€…çš„å®ç°<br>9ã€è¿­ä»£å™¨æ¨¡å¼<br>å¦‚ï¼šè¿­ä»£å™¨æ¨¡å¼PropertyTokenizer</p>`,104)]))}const c=n(l,[["render",t]]),o=JSON.parse('{"path":"/posts/interview/interview/tech/Mybatis%20%E9%82%A3%E7%82%B9%E7%A0%B4%E4%BA%8B.html","title":"ç¬¬ä¹ç¯‡ï¼šMybatis ï¼ ORMï¼ŒåŠ¨æ€SQLã€åŠ¨æ€ä»£ç†","lang":"zh-CN","frontmatter":{"title":"ç¬¬ä¹ç¯‡ï¼šMybatis ï¼ ORMï¼ŒåŠ¨æ€SQLã€åŠ¨æ€ä»£ç†","description":"Mybatis é‚£ç‚¹ç ´äº‹ï¼ ORMï¼ŒåŠ¨æ€SQLã€åŠ¨æ€ä»£ç† ä½œè€…ï¼šè€é©¬ å…¬ä¼—å·ï¼šè€é©¬å•¸è¥¿é£ åšå®¢ï¼šhttps://houbb.github.io/ äººç”Ÿç†å¿µï¼šçŸ¥è¡Œåˆä¸€ ä»€ä¹ˆæ˜¯ MyBatis? ç­”æ¡ˆï¼šMybatis æ˜¯ä¸€ä¸ªåŠ ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ¡†æ¶ï¼Œå®ƒå†…éƒ¨å°è£…äº† JDBCï¼Œå¼€å‘æ—¶åªéœ€è¦å…³æ³¨ SQL è¯­å¥æœ¬èº«ï¼Œä¸éœ€è¦èŠ±è´¹ç²¾åŠ›å»å¤„ç†åŠ è½½é©±åŠ¨ã€åˆ›å»ºè¿æ¥ã€åˆ›...","head":[["meta",{"property":"og:url","content":"https://houbb.github.io/vpress/posts/interview/interview/tech/Mybatis%20%E9%82%A3%E7%82%B9%E7%A0%B4%E4%BA%8B.html"}],["meta",{"property":"og:site_name","content":"è€é©¬å•¸è¥¿é£"}],["meta",{"property":"og:title","content":"ç¬¬ä¹ç¯‡ï¼šMybatis ï¼ ORMï¼ŒåŠ¨æ€SQLã€åŠ¨æ€ä»£ç†"}],["meta",{"property":"og:description","content":"Mybatis é‚£ç‚¹ç ´äº‹ï¼ ORMï¼ŒåŠ¨æ€SQLã€åŠ¨æ€ä»£ç† ä½œè€…ï¼šè€é©¬ å…¬ä¼—å·ï¼šè€é©¬å•¸è¥¿é£ åšå®¢ï¼šhttps://houbb.github.io/ äººç”Ÿç†å¿µï¼šçŸ¥è¡Œåˆä¸€ ä»€ä¹ˆæ˜¯ MyBatis? ç­”æ¡ˆï¼šMybatis æ˜¯ä¸€ä¸ªåŠ ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ¡†æ¶ï¼Œå®ƒå†…éƒ¨å°è£…äº† JDBCï¼Œå¼€å‘æ—¶åªéœ€è¦å…³æ³¨ SQL è¯­å¥æœ¬èº«ï¼Œä¸éœ€è¦èŠ±è´¹ç²¾åŠ›å»å¤„ç†åŠ è½½é©±åŠ¨ã€åˆ›å»ºè¿æ¥ã€åˆ›..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-03-30T09:38:40.000Z"}],["meta",{"property":"article:modified_time","content":"2025-03-30T09:38:40.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ç¬¬ä¹ç¯‡ï¼šMybatis ï¼ ORMï¼ŒåŠ¨æ€SQLã€åŠ¨æ€ä»£ç†\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-03-30T09:38:40.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"è€é©¬å•¸è¥¿é£\\",\\"url\\":\\"https://houbb.github.io\\"}]}"]]},"git":{"createdTime":1743327520000,"updatedTime":1743327520000,"contributors":[{"name":"houbb","username":"houbb","email":"houbinbin.echo@gmail.com","commits":1,"url":"https://github.com/houbb"}]},"readingTime":{"minutes":16.41,"words":4923},"filePathRelative":"posts/interview/interview/tech/Mybatis é‚£ç‚¹ç ´äº‹.md","localizedDate":"2025å¹´3æœˆ30æ—¥","excerpt":"\\n<blockquote>\\n<p>ä½œè€…ï¼šè€é©¬<br>\\n<br>å…¬ä¼—å·ï¼šè€é©¬å•¸è¥¿é£<br>\\n<br> åšå®¢ï¼š<a href=\\"https://houbb.github.io/\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://houbb.github.io/</a><br>\\n<br> äººç”Ÿç†å¿µï¼šçŸ¥è¡Œåˆä¸€</p>\\n</blockquote>\\n<h2><strong>ä»€ä¹ˆæ˜¯ MyBatis?</strong></h2>\\n<p>ç­”æ¡ˆï¼š<br>Mybatis æ˜¯ä¸€ä¸ªåŠ ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ¡†æ¶ï¼Œå®ƒå†…éƒ¨å°è£…äº† JDBCï¼Œå¼€å‘æ—¶åªéœ€è¦å…³æ³¨ SQL è¯­å¥æœ¬èº«ï¼Œä¸éœ€è¦èŠ±è´¹ç²¾åŠ›å»å¤„ç†åŠ è½½é©±åŠ¨ã€åˆ›å»ºè¿æ¥ã€åˆ›å»ºstatement ç­‰ç¹æ‚çš„è¿‡ç¨‹ã€‚ç¨‹åºå‘˜ç›´æ¥ç¼–å†™åŸç”Ÿæ€ sqlï¼Œå¯ä»¥ä¸¥æ ¼æ§åˆ¶ sql æ‰§è¡Œæ€§èƒ½ï¼Œçµæ´»åº¦é«˜ã€‚<br>MyBatis å¯ä»¥ä½¿ç”¨ XML æˆ–æ³¨è§£æ¥é…ç½®å’Œæ˜ å°„åŸç”Ÿä¿¡æ¯ï¼Œå°† POJO æ˜ å°„æˆæ•°æ®åº“ä¸­çš„è®°å½•ï¼Œé¿å…äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç å’Œæ‰‹åŠ¨è®¾ç½®å‚æ•°ä»¥åŠè·å–ç»“æœé›†ã€‚<br>é€šè¿‡ xml æ–‡ä»¶æˆ–æ³¨è§£çš„æ–¹å¼å°†è¦æ‰§è¡Œçš„å„ç§ statement é…ç½®èµ·æ¥ï¼Œå¹¶é€šè¿‡ java å¯¹è±¡å’Œ statement ä¸­ sql çš„åŠ¨æ€å‚æ•°è¿›è¡Œæ˜ å°„ç”Ÿæˆæœ€ç»ˆæ‰§è¡Œçš„ sql è¯­å¥ï¼Œæœ€åç”± mybatis æ¡†æ¶æ‰§è¡Œ sql å¹¶å°†ç»“æœæ˜ å°„ä¸º java å¯¹è±¡å¹¶è¿”å›ã€‚ï¼ˆä»æ‰§è¡Œ sql åˆ°è¿” å› result çš„è¿‡ç¨‹ï¼‰ã€‚</p>","autoDesc":true}');export{c as comp,o as data};
