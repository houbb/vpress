import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as i,a as r,o as a}from"./app-NomDibRt.js";const o={};function n(s,e){return a(),i("div",null,e[0]||(e[0]=[r('<h1 id="代码篇-学会13-种锁-从此不再为-锁-心烦" tabindex="-1"><a class="header-anchor" href="#代码篇-学会13-种锁-从此不再为-锁-心烦"><span>代码篇：学会13 种锁，从此不再为“锁”心烦</span></a></h1><blockquote><p>作者：老马<br><br>公众号：老马啸西风<br><br> 博客：<a href="https://houbb.github.io/" target="_blank" rel="noopener noreferrer">https://houbb.github.io/</a><br><br> 人生理念：知行合一</p></blockquote><p>分布式系统时代，线程并发，资源抢占，&quot;锁&quot; 慢慢变得很重要。</p><p>那么常见的锁都有哪些？</p><p>今天老马就和大家简单聊聊这个话题</p><h2 id="_1、悲观锁" tabindex="-1"><a class="header-anchor" href="#_1、悲观锁"><span>1、悲观锁</span></a></h2><p>正如其名，它是指对数据修改时持保守态度，认为其他人也会修改数据。因此在操作数据时，会把数据锁住，直到操作完成。</p><p>悲观锁大多数情况下依靠数据库的锁机制实现，以保证操作最大程度的独占性。如果加锁的时间过长，其他用户长时间无法访问，影响程序的并发访问性，同时这样对数据库性能开销影响也很大，特别是长事务而言，这样的开销往往无法承受。</p><p>如果是单机系统，我们可以采用 JAVA 自带的 synchronized 关键字，通过添加到方法或同步块上，锁住资源</p><p>如果是分布式系统，我们可以借助数据库自身的锁机制来实现</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span> select * from 表名 where id= #{id} for update</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>使用悲观锁的时候，我们要注意锁的级别，MySQL innodb 在加锁时，只有明确的指定主键或（索引字段）才会使用 行锁 ；否则，会执行 表锁 ，将整个表锁住，此时性能会很差。</p><p>在使用悲观锁时，我们必须关闭 MySQL 数据库的自动提交属性，因为mysql默认使用自动提交模式。悲观锁适用于写多的场景，而且并发性能要求不高</p><h2 id="_2、乐观锁" tabindex="-1"><a class="header-anchor" href="#_2、乐观锁"><span>2、乐观锁</span></a></h2><p>乐观锁，从字面意思也能猜到个大概，在操作数据时非常乐观，认为别人不会同时修改数据，因此乐观锁不会上锁<br> 只是在 提交更新 时，才会正式对数据的冲突与否进行检测。如果发现冲突了，则返回错误信息，让用户决定如何去做，fail-fast 机制 。否则，执行本次操作。</p><p>分为三个阶段：数据读取、写入校验、数据写入。</p><p>如果是单机系统，我们可以基于JAVA 的 CAS来实现，CAS 是一种原子操作，借助硬件的比较并交换来实现。<br> 如果是分布式系统，我们可以在数据库表中增加一个 版本号 字段，如：version</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>update 表  set ... , version = version +1  where id= #{id} and version = #{version}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>',18)]))}const l=t(o,[["render",n]]),c=JSON.parse('{"path":"/posts/interview/pay/arch/%E4%BB%A3%E7%A0%81%E7%AF%87%EF%BC%9A%E5%AD%A6%E4%BC%9A13%20%E7%A7%8D%E9%94%81%EF%BC%8C%E4%BB%8E%E6%AD%A4%E4%B8%8D%E5%86%8D%E4%B8%BA%E2%80%9C%E9%94%81%E2%80%9D%E5%BF%83%E7%83%A6.html","title":"代码篇：学会13 种锁，从此不再为“锁”心烦","lang":"zh-CN","frontmatter":{"title":"代码篇：学会13 种锁，从此不再为“锁”心烦","pay":"https://articles.zsxq.com/id_zd1u3uho77uc.html","description":"代码篇：学会13 种锁，从此不再为“锁”心烦 作者：老马 公众号：老马啸西风 博客：https://houbb.github.io/ 人生理念：知行合一 分布式系统时代，线程并发，资源抢占，\\"锁\\" 慢慢变得很重要。 那么常见的锁都有哪些？ 今天老马就和大家简单聊聊这个话题 1、悲观锁 正如其名，它是指对数据修改时持保守态度，认为其他人也会修改数据。因此...","head":[["meta",{"property":"og:url","content":"https://houbb.github.io/vpress/posts/interview/pay/arch/%E4%BB%A3%E7%A0%81%E7%AF%87%EF%BC%9A%E5%AD%A6%E4%BC%9A13%20%E7%A7%8D%E9%94%81%EF%BC%8C%E4%BB%8E%E6%AD%A4%E4%B8%8D%E5%86%8D%E4%B8%BA%E2%80%9C%E9%94%81%E2%80%9D%E5%BF%83%E7%83%A6.html"}],["meta",{"property":"og:site_name","content":"老马啸西风"}],["meta",{"property":"og:title","content":"代码篇：学会13 种锁，从此不再为“锁”心烦"}],["meta",{"property":"og:description","content":"代码篇：学会13 种锁，从此不再为“锁”心烦 作者：老马 公众号：老马啸西风 博客：https://houbb.github.io/ 人生理念：知行合一 分布式系统时代，线程并发，资源抢占，\\"锁\\" 慢慢变得很重要。 那么常见的锁都有哪些？ 今天老马就和大家简单聊聊这个话题 1、悲观锁 正如其名，它是指对数据修改时持保守态度，认为其他人也会修改数据。因此..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-03-30T09:38:40.000Z"}],["meta",{"property":"article:modified_time","content":"2025-03-30T09:38:40.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"代码篇：学会13 种锁，从此不再为“锁”心烦\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-03-30T09:38:40.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"老马啸西风\\",\\"url\\":\\"https://houbb.github.io\\"}]}"]]},"git":{"createdTime":1743327520000,"updatedTime":1743327520000,"contributors":[{"name":"houbb","username":"houbb","email":"houbinbin.echo@gmail.com","commits":1,"url":"https://github.com/houbb"}]},"readingTime":{"minutes":2.23,"words":668},"filePathRelative":"posts/interview/pay/arch/代码篇：学会13 种锁，从此不再为“锁”心烦.md","localizedDate":"2025年3月30日","excerpt":"\\n<blockquote>\\n<p>作者：老马<br>\\n<br>公众号：老马啸西风<br>\\n<br> 博客：<a href=\\"https://houbb.github.io/\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://houbb.github.io/</a><br>\\n<br> 人生理念：知行合一</p>\\n</blockquote>\\n<p>分布式系统时代，线程并发，资源抢占，\\"锁\\" 慢慢变得很重要。</p>\\n<p>那么常见的锁都有哪些？</p>\\n<p>今天老马就和大家简单聊聊这个话题</p>\\n<h2>1、悲观锁</h2>\\n<p>正如其名，它是指对数据修改时持保守态度，认为其他人也会修改数据。因此在操作数据时，会把数据锁住，直到操作完成。</p>","autoDesc":true}');export{l as comp,c as data};
